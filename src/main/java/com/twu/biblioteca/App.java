/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package com.twu.biblioteca;

import com.twu.biblioteca.exceptions.MenuException;
import com.twu.biblioteca.options.*;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

public class App {

    static private BufferedReader reader;
    static private Printer printer;

    public static void main(String[] args) {
        reader = new BufferedReader(new InputStreamReader(System.in));
        printer = new Printer(System.out);

        Library<Book> bookLibrary = new Library<>(printer, Data.bookList);
        Library<Movie> movieLibrary = new Library<>(printer, Data.movieList);

        Menu menu = createMenu(bookLibrary, movieLibrary);

        printer.print(Constants.WELCOME_MESSAGE);

        int optionNumber;
        do {
            printer.print(menu);
            optionNumber = requestAction();
            try {
                menu.select(optionNumber);
            }
            catch (MenuException e) {
                printer.print(e.getMessage());
            }
        }
        while (optionNumber != 0);
    }

    private static Menu createMenu (Library<Book> bookLibrary, Library<Movie> movieLibrary) {
        Menu menu = new Menu();

        Option exitOption = new ExitOption();

        Option listOfBooks = new ListOfBooksOption(bookLibrary, printer);
        Option checkoutBookOption = new CheckoutBookOption(printer, reader, bookLibrary);
        Option returnBookOption = new ReturnBookOption(printer, reader, bookLibrary);
        Option viewCheckedOutBooks = new ViewCheckedOutBooksOption(printer, bookLibrary);

        Option listOfMovies = new ListOfMoviesOption(movieLibrary, printer);
        Option checkoutMovieOption = new CheckoutMovieOption(printer, reader, movieLibrary);
        Option returnMovieOption = new ReturnMovieOption(printer, reader, movieLibrary);
        Option viewCheckedOutMovies = new ViewCheckedOutMoviesOption(printer, movieLibrary);

        Option logInOption = new LogInOption(printer, reader);
        Option logOutOption = new LogOutOption(printer);
        Option viewUserInformationOption = new ViewUserInformationOption(printer);

        menu.add(exitOption);

        menu.add(listOfBooks);
        menu.add(checkoutBookOption);
        menu.add(returnBookOption);
        menu.add(viewCheckedOutBooks);

        menu.add(listOfMovies);
        menu.add(checkoutMovieOption);
        menu.add(returnMovieOption);
        menu.add(viewCheckedOutMovies);

        menu.add(logInOption);
        menu.add(logOutOption);
        menu.add(viewUserInformationOption);

        return menu;
    }

    private static int requestAction() {
        String input = null;
        int optionNumber;

        try {
            input = reader.readLine();
        }
        catch (IOException e) {
            printer.print("Error reading output:\n".concat(e.getMessage()));
        }

        try {
            optionNumber = Integer.parseInt(input);
        }
        catch (NumberFormatException e) {
            printer.print(Constants.ERROR_INVALID_OPTION);
            return -1;
        }
        return optionNumber;
    }
}
